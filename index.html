<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AirPredict AI Dashboard (Map + Forecast)</title>

  <link rel="stylesheet" href="./model.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
  <div class="container">
    <div class="topbar">
      <div class="title">
        <h1>AirPredict AI ‚Äî PM2.5 Dashboard</h1>
        <div class="sub">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: Firebase Realtime Database ‚Ä¢ ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô + ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå</div>
      </div>

      <div class="actions">
        <div class="pill" id="lastUpdatePill">‚óè ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>

        <div class="themeToggle" title="‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î">
          <span class="toggleLabel" id="toggleLabel">Light</span>
          <label class="switch">
            <input type="checkbox" id="themeSwitch">
            <span class="slider"></span>
          </label>
        </div>

        <button class="btn" id="refreshBtn" type="button">‚ü≥ Refresh</button>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ü§ñ AI Insight</div>
      <div class="big" id="ai_pred_pm25">--</div>
      <div class="muted" id="ai_pred_note">AI ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ: -- (--) </div>

      <div class="chips" style="margin-top:10px;">
        <span class="chip">üìè RMSE: <b id="ai_rmse">--</b></span>
        <span class="chip">‚úÖ Confidence: <b id="ai_conf">--</b></span>
      </div>
    </div>

    <div class="card">
      <div class="card-title">üè• ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ï‡∏≤‡∏° AQI</div>
      <div class="muted" id="health_advice">--</div>
    </div>

    <div class="card" style="padding:0; overflow:hidden;">
        <div id="map"></div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</div>
        <div style="margin-top:10px">
          <select id="provinceSelect"></select>
        </div>

        <div class="realtimeBox" id="realtimeBox" style="margin-top:14px">
          <div class="realtimeTitle">üì° ‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå PM2.5 (PMS5003)</div>
          <div class="realtimeValue">
            <span id="rtPm25">--</span>
            <small>¬µg/m¬≥</small>
          </div>
          <div class="realtimeTime" id="rtTime">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: --</div>
        </div>

        <div class="chips">
          <span class="chip">‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <b>7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</b></span>
          <span class="chip">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: <b>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</b></span>
        </div>
      </div>

      <div class="card">
        <div class="label">PM2.5 ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (¬µg/m¬≥)</div>
        <div class="big" id="latestPm25">-</div>
        <div class="sub" id="latestTime">-</div>

        <div class="chips">
          <span class="chip">Province: <b id="metaProvince">-</b></span>
          <span class="chip">Level: <b id="metaLevel">-</b></span>
        </div>
      </div>

      <div class="card">
        <div class="label">AQI ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
        <div class="big" id="latestAqi">-</div>
        <div id="levelBadge" class="badge"><span class="dot"></span><span>-</span></div>
        <div class="sub" id="adviceText" style="margin-top:8px;line-height:1.55">-</div>
      </div>
    </div>

    <div class="chartWrap">
      <div class="chartTop">
        <div class="label">‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô + <span style="color:#FF5733; font-weight:bold;">‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ (AI)</span></div>
      </div>
      <canvas id="pm25Chart" height="120"></canvas>
    </div>

    <div class="footer">Tip: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• AI Prediction ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAAk3JQbgY9AnjUSOIQx94pjDa5JTgpv5o",
      authDomain: "airpredict-ai.firebaseapp.com",
      databaseURL: "https://airpredict-ai-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "airpredict-ai",
      storageBucket: "airpredict-ai.firebasestorage.app",
      messagingSenderId: "193432037602",
      appId: "1:193432037602:web:32a4ae5aabaf9a261e96bb",
      measurementId: "G-JJ95QX0ZP7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ‡πÉ‡∏´‡πâ app.js ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ app.js ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà module)
    window.__fb = { db, ref, onValue };

    // ‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤ Firebase ‡∏û‡∏£‡πâ‡∏≠‡∏°
    window.dispatchEvent(new Event("firebase-ready"));
  </script>

  <script src="./app.js" defer></script>
</body>
</html>
